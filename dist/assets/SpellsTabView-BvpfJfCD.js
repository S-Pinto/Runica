import{j as e,u as b,r as p,g as N,b as g,f as v}from"./index-uBceAcs4.js";const f=({title:t,slots:o,onSlotChange:l,isCustom:n=!1})=>{const u=(a,r)=>{if(n){const s=o,c=s.findIndex(j=>j.id===a);if(c===-1)return;const m=s[c],d=r<m.used?r:r+1,h=[...s];h[c]={...m,used:d},l(h)}else{const s=o,c=s[a],m=r<c.used?r:r+1;l({...s,[a]:{...c,used:m}})}},x=n?o:Object.entries(o),i=n?x.some(a=>a.max>0):x.some(([,a])=>a.max>0);return e.jsxs("div",{className:"bg-card p-4 rounded-lg border border-border",children:[e.jsx("h3",{className:"text-lg font-cinzel text-accent mb-3",children:t}),!i&&e.jsx("p",{className:"text-muted-foreground text-sm text-center",children:"No resources available."}),e.jsx("div",{className:"space-y-3",children:x.map(a=>{let r,s;n?(r=a.id,s=a):(r=a[0],s=a[1]);const c=n?s.name:`Lvl ${r}`;return s.max===0?null:e.jsxs("div",{className:"flex items-center",children:[e.jsxs("span",{className:"font-bold text-muted-foreground w-24 truncate",title:c,children:[c,":"]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:Array.from({length:s.max}).map((m,d)=>e.jsx("button",{onClick:()=>u(r,d),className:`w-5 h-5 rounded-md border-2 transition-colors ${d<s.used?"bg-primary border-primary/80":"bg-muted border-border hover:border-accent"}`,"aria-label":`Slot ${d+1} for ${c}. ${d<s.used?"Used":"Available"}`},d))})]},r)})})]})},S=({spell:t,onToggleExpand:o,isExpanded:l})=>e.jsxs("div",{className:"bg-card/50 rounded-lg",children:[e.jsxs("div",{className:"flex justify-between items-center cursor-pointer p-3",onClick:o,children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h4",{className:"font-bold text-accent truncate",title:t.name,children:t.name}),e.jsxs("div",{className:"flex items-center gap-2 text-xs text-muted-foreground mt-1",children:[e.jsx("span",{className:"truncate",title:t.castingTime,children:t.castingTime}),e.jsx("span",{className:"opacity-50",children:"|"}),e.jsx("span",{className:"truncate",title:t.range,children:t.range})]})]}),e.jsx("div",{className:"flex items-center gap-2 pl-2 flex-shrink-0",children:e.jsx("span",{className:"text-xs text-muted-foreground capitalize",children:t.school})})]}),l&&e.jsxs("div",{className:"mt-2 pt-3 border-t border-border/50 space-y-2 text-sm p-3 bg-muted/30",children:[e.jsxs("p",{children:[e.jsx("strong",{className:"text-muted-foreground",children:"Components:"})," ",t.components]}),e.jsxs("p",{children:[e.jsx("strong",{className:"text-muted-foreground",children:"Duration:"})," ",t.duration]}),e.jsx("p",{className:"text-foreground mt-2 whitespace-pre-wrap",children:t.description})]})]}),y=()=>{const{character:t}=b(),[o,l]=p.useState({}),[n,u]=p.useState(""),x=r=>{l(s=>({...s,[r]:!s[r]}))},i=p.useMemo(()=>t?t.spells.filter(s=>s.name.toLowerCase().includes(n.toLowerCase())).reduce((s,c)=>(s[c.level]=[...s[c.level]||[],c],s[c.level].sort((m,d)=>m.name.localeCompare(d.name)),s),{}):{},[t,n]),a=Object.keys(i).map(Number).sort((r,s)=>r-s);return t?e.jsxs("div",{className:"bg-card p-4 rounded-lg border border-border flex flex-col h-auto max-h-[calc(100vh-10rem)]",children:[e.jsx("div",{className:"flex justify-between items-center mb-2",children:e.jsx("h3",{className:"text-lg font-cinzel text-accent",children:"Spellbook"})}),e.jsx("div",{className:"mb-4",children:e.jsx("input",{type:"text",placeholder:"Search spells...",value:n,onChange:r=>u(r.target.value),className:"w-full bg-input p-2 rounded-md border border-border text-sm focus:ring-ring focus:border-accent"})}),e.jsx("div",{className:"space-y-6 overflow-y-auto pr-2 -mr-2 flex-grow",children:t.spells.length===0?e.jsx("div",{className:"flex items-center justify-center h-full",children:e.jsx("p",{className:"text-center text-muted-foreground text-sm py-8",children:"This character knows no spells."})}):a.length===0?e.jsx("div",{className:"flex items-center justify-center h-full",children:e.jsx("p",{className:"text-center text-muted-foreground text-sm py-8",children:"No spells match your search."})}):a.map(r=>e.jsxs("div",{children:[e.jsx("h4",{className:"text-xl font-serif text-foreground border-b border-border pb-1 mb-3",children:r===0?"Cantrips":`Level ${r}`}),e.jsx("div",{className:"space-y-3",children:i[r].map(s=>e.jsx(S,{spell:s,isExpanded:!!o[s.id],onToggleExpand:()=>x(s.id)},s.id))})]},r))})]}):null},C=()=>{const{character:t,updateCharacter:o}=b(),l=t.spellcastingAbility,n=l?N(t.abilityScores[l]):0,u=l?8+t.proficiencyBonus+n:"-",x=l?t.proficiencyBonus+n:0;return e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"lg:col-span-1 space-y-6",children:[e.jsxs("div",{className:"bg-card p-4 rounded-lg border border-border",children:[e.jsx("h3",{className:"text-lg font-cinzel text-accent mb-3 text-center",children:"Spellcasting"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(g,{label:"Save DC",value:u}),e.jsx(g,{label:"Attack Bonus",value:v(x)}),e.jsxs("div",{className:"col-span-2 text-center",children:[e.jsx("p",{className:"text-xs uppercase tracking-wider text-muted-foreground",children:"Ability"}),e.jsx("p",{className:"text-xl font-bold text-foreground capitalize",children:l||"None"})]})]})]}),e.jsx(f,{title:"Spell Slots",slots:t.spellSlots,onSlotChange:i=>o({spellSlots:i})}),t.customResources&&t.customResources.length>0&&e.jsx(f,{title:"Other Resources",slots:t.customResources,onSlotChange:i=>o({customResources:i}),isCustom:!0})]}),e.jsx("div",{className:"lg:col-span-2",children:e.jsx(y,{})})]})};export{C as default};
