rules_version = '2';

service firebase.storage {
  match /b/{bucket}/o {

    // Regole per le immagini del profilo utente
    match /users/{userId}/profile.jpg {
      // Chiunque può leggere le immagini del profilo.
      allow read;

      // Solo il proprietario può scrivere la propria immagine del profilo,
      // con validazione su tipo e dimensione del file.
      allow write: if request.auth != null && request.auth.uid == userId
                   && request.resource.size < 500 * 1024
                   && request.resource.contentType.matches('image/.*');
    }

    // Regole per i ritratti dei personaggi
    match /users/{userId}/character-portraits/{characterId} {
        // Chiunque può leggere i ritratti dei personaggi.
        allow read;

        // Solo il proprietario può scrivere i ritratti per i propri personaggi,
        // con validazione su tipo e dimensione del file.
        allow write: if request.auth != null && request.auth.uid == userId
                     && request.resource.size < 1 * 1024 * 1024 // 1MB
                     && request.resource.contentType.matches('image/.*');
    }
  }
}

